#!/bin/bash

SOURCE_DIR={{ backup.source }}
DESTINATION_DIR={{ backup.destination }}
LOG_DIR={{ backup.logdir }}
LOG_FILE="$LOG_DIR/{{ backup.name | replace('-','_') }}_`date +"%Y_%m_%d"`.log"

echo "* CHECK of {{ backup.name }} backup needs at `date +"%Hh%M"`" >> $LOG_FILE
/usr/bin/rsync \
    -a{{ backup.rsync_option | default(omit) }} \
    --exclude "lost+found" \
    $SOURCE_DIR \
    $DESTINATION_DIR/{{ backup.name | replace('-','_') }}_`date +"%Y_%m_%d"` \
    | sed 's/^/\t/'  >> $LOG_FILE
